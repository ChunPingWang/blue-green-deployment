# 研究報告：測試腳本與專案文件

**功能分支**: `002-test-script-readme`
**日期**: 2025-12-04

## 研究項目

### 1. Shell Script 流量測試最佳實踐

**決策**: 使用 Bash + curl 實作測試腳本

**理由**:
- curl 是幾乎所有 Unix-like 系統的標準工具
- Bash 腳本無需編譯，易於修改和除錯
- 簡單的文字輸出易於閱讀和管道處理

**考慮的替代方案**:
| 方案 | 優點 | 缺點 | 結論 |
|------|------|------|------|
| Python + requests | 強大的 HTTP 處理 | 需要 Python 環境 | 過度複雜 |
| wget | 廣泛可用 | 輸出格式不如 curl 靈活 | 不採用 |
| httpie | 友善的 CLI | 需要額外安裝 | 增加依賴 |
| Bash + curl | 無額外依賴 | 功能較簡單 | ✅ 採用 |

### 2. 流量統計呈現方式

**決策**: 採用純文字輸出搭配簡易進度指示

**理由**:
- 終端機相容性最佳
- 無需額外繪圖工具
- 易於複製貼上分享結果

**輸出格式設計**:
```text
🔵 測試藍綠佈署流量分配
━━━━━━━━━━━━━━━━━━━━━━━━
端點: http://localhost:8080/greeting
請求次數: 100

執行中... [██████████████████████] 100%

📊 結果統計
━━━━━━━━━━━━━━━━━━━━━━━━
🔵 Blue Service:  20 次 (20.0%)
🟢 Green Service: 80 次 (80.0%)
❌ 失敗:           0 次 (0.0%)
━━━━━━━━━━━━━━━━━━━━━━━━
總計: 100 次 | 耗時: 5.2 秒
```

### 3. README 結構最佳實踐

**決策**: 採用標準開源專案 README 結構

**理由**:
- 符合開發者習慣的閱讀順序
- 包含所有必要資訊
- 易於快速找到所需內容

**章節結構**:
1. 專案標題與簡介
2. 架構說明（含圖示）
3. 前置需求
4. 快速開始（啟動步驟）
5. 測試腳本使用說明
6. 專案結構說明

### 4. 架構圖呈現方式

**決策**: 使用 ASCII 藝術圖 + Mermaid 圖表

**理由**:
- ASCII 圖在任何環境都能正確顯示
- Mermaid 在 GitHub 上會自動渲染
- 兩種方式互補，確保可讀性

**架構圖設計**:
```text
                    ┌─────────────────┐
                    │   API Gateway   │
                    │  (Port: 8080)   │
                    └────────┬────────┘
                             │
              ┌──────────────┴──────────────┐
              │                             │
              ▼ 20%                         ▼ 80%
    ┌─────────────────┐           ┌─────────────────┐
    │  Blue Service   │           │  Green Service  │
    │  (Port: 8081)   │           │  (Port: 8082)   │
    └─────────────────┘           └─────────────────┘
```

### 5. 錯誤處理策略

**決策**: 提供清楚的錯誤訊息並建議解決方案

**錯誤情境與處理**:

| 錯誤情境 | 偵測方式 | 錯誤訊息 |
|----------|----------|----------|
| 閘道未啟動 | curl 返回碼 7 | "❌ 錯誤：無法連線到 API 閘道。請確認服務已啟動。" |
| 無效參數 | 參數驗證 | "❌ 錯誤：請求次數必須為正整數。用法: ./test-traffic.sh [次數]" |
| 部分請求失敗 | HTTP 狀態碼 | 在統計中顯示失敗次數 |
| curl 未安裝 | command -v | "❌ 錯誤：找不到 curl。請先安裝 curl。" |

## 技術決策摘要

| 項目 | 決策 | 理由 |
|------|------|------|
| 腳本語言 | Bash 4.0+ | 廣泛支援、無需編譯 |
| HTTP 工具 | curl | 系統標準工具 |
| 輸出格式 | 純文字 + emoji | 清楚易讀 |
| 架構圖 | ASCII + Mermaid | 雙重相容 |
| 錯誤處理 | 友善訊息 + 建議 | 提升使用者體驗 |

## 未解決項目

無。所有技術決策已確定。
